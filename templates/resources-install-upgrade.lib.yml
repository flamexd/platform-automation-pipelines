#! resources template

#@ load("functions.lib.yml", "products")

storage-params: &storage-params
  storage_account_name: ((azure_blob.username))
  storage_account_key: ((azure_blob.password))
  container: ((azure_blob_container))
  base_url: ((azure_blob_url))

resource_types: 
- name: azure-blobstore
  type: docker-image
  source:
    repository: pcfabr/azure-blobstore-resource

resources:

#@ def resources():

- name: platform-automation-tasks
  type: azure-blobstore
  source:
    regexp: .*tasks-(.*).zip
    <<: *storage-params

- name: platform-automation-image
  type: azure-blobstore
  source:
    regexp: .*image-(.*).tgz
    <<: *storage-params

- name: installation
  type: azure-blobstore
  source:
    regexp: installation-(.*).zip
    <<: *storage-params


- name: configuration
  type: git
  source:
    private_key: ((git.user.private_key))
    uri: ((git.configuration.uri))
    branch: master


#! product related resourses

#@ for product in products():

#@ product_alias="{}".format(product).split("|")[0]
#@ product_slug="{}".format(product).split("|")[1]

- name: #@ "product-config-{}".format(product_alias)
  type: semver-config
  source:
    driver: git
    uri: ((git.configuration.uri))
    branch: master
    private_key: ((git.user.private_key))
    config_file: foundation/((foundation))/((git.configuration.products_file))
    config_path: #@ "products.{}".format(product_alias)
    version_path: #@ "products.{}.product-version".format(product_alias)
    version_pattern: "m.n.*"

#@ end
#! end of for product in products():

#@ end
#! end of def resources():
